За "начальную систему" была взята реализация системы из описания к домашней работе
![[Исходная система.svg]]
В конце 3 домашнего задания, система выглядела вот так:
![[Конечная структура системы 1.svg]]
**Сравнение исходной и конечной системы**

Общее у исходной и конечной систем:
- Система ставок
- Отбор кандидатов в воркеры
- Производство fur-tune печенья

Различия у исходной и конечной систем:
- У исходной системы отдельный энтити-сервис воркеров
- Сборка расходников в исходной системе отдельная, а в конечной системе в этом же сервисе выполняется планирование работы воркеров
- Матчинг в исходной системе находится в сервисе с планированием визитов и контролем качества, а в конечной системе матчинг отдельный
- Планирование визитов в исходной системе находится в сервисе с контролем качества и матчингом, а в конечном варианте оно находится в сервисе со сборкой расходников
- Контроль качества в исходной системе находится в сервисе с матчингом и планированием визитов, а в конечной системе это отдельный сервис
- Расчет и списание средств у клиентов и сотрудников в исходной системе - это один сервис, а в конечной системе это два отдельных сервиса

Не понятно где в исходной системе происходит оформление и выполнение заказов, судя по всему, это все относится к "планированию визитов".
В конечной системе выплаты и списания происходят во внешнем сервисе золотая шляпа, в исходной версии этот момент не указан.
В исходной системе указана внешняя система happy cat box, откуда попадают пользователи-клиенты

**Последовательность действий**
Предположим что у нас есть свободные люди и ресурсы, инфраструктура готова к миграции, а опыта нет.

**1. Расчет и списание средств у клиентов и сотрудников**
Instability = 0/(2+0)=0

Данный сервис реализует два разных бизнес процесса.
Поэтому разобьем этот сервис на два.
1) Расчет стоимости услуг и оплата
2) Расчет зарплаты сотрудников

После этого у обоих сервисов instability останется равным нулю (если учесть золотую шляпу, то 0.5).

**2. Сервис с планированием визитов, контролем качества и матчингом**
Входящих стрелок: 3, выходящих стрелок: 3. Начальное значение instability=3/(3+3)=0.5.

**2.1. Интеллектуальный матчинг сотрудников и клиентов**
Данный сервис требует отдельной базы данных, в которой будут храниться подготовленные данные для выполнения алгоритма.
Поэтому вынесем матчинг в отдельный сервис применяя Change Capture Data. Связанный синхронно с планированием визитов (оформление заказов).

**2.2. Контроль качества работы сотрудников**
На мой взгляд, данный компонент должен быть отделен, так как он не имеет тесных связей с бизнес-процессами оформления заказов.
Вынесем его в отдельный сервис, в которой будут попадать асинхронно данные о результатах завершенных заказов (выполнен, не выполнен, отменен).

Определим instability после выноса сервисов:
- Матчинг
  - Instability = 1/(1+1)=0.5
- Контроль качества
  - Instability=0/(1+0)=0.5
- Планирование визитов (оформление заказов)
  - Instability=6/(2+6)=3/4=0.75

**3. Энтити-сервис воркеров**
Входящих стрелок: 1. Исходящих стрелок: 5. Начальное значение instability=5/(1+5)=5/6=0.83
На этом сервисе слишком много всего завязано. При изменении любого из связанных сервисов есть шанс сломать энтити-сервис воркеров.
Поэтому удалим данный сервис. А данные о воркерах будут храниться в том же сервисе, где и оформляются заказы (планирование визитов).
